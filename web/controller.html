<script
  type="text/javascript"
  src="https://www.airconsole.com/api/airconsole-1.8.0.js"
></script>

<link rel="stylesheet" href="/css/css.css" />
<link rel="stylesheet" href="/css/controller.css" />

<body>
  <div id="playerId"></div>

  <div id="active-player">

    <!-- We can define different screens which can be changed from the game code -->
    <div id="screen-lobby">
      <!-- Each screen can have different actions and displays -->
      <button class="input" id="action-1">Action 1</button>
      <button class="input" id="action-2">Action 2</button>
    </div>

    <div id="screen-game">
      <!-- Each screen can have different actions and displays -->
      <button class="input" id="action-3">Action 3</button>
      <button class="input" id="action-4">Action 4</button>
    </div>
  </div>

  <div id="inactive-player">
    Sorry! You are not an active player.
  </div>
 
</body>

<script type="text/javascript">
  let airconsole = new AirConsole({
    orientation: "landscape",
  }); // Can adjust options here

  // Perform logic based on if the controller is active (not just connected). A controller is not active when the screen has limited the number of players.
  // Can be used to show a message to the user that they can't play because there are too many players, or to show a message that they are player 1, 2, 3, etc.
  airconsole.onActivePlayersChange = function(playerId) {
    let activePlayerDiv = document.getElementById("active-player");
    let inactivePlayerDiv = document.getElementById("inactive-player");
    let playerIdDiv = document.getElementById("playerId");

    let deviceId = airconsole.getActivePlayerDeviceId(playerId);
    
    if (playerId !== undefined) {
      // If player is set, then this controller is active
      activePlayerDiv.style.display = "block";
      inactivePlayerDiv.style.display = "none";

      playerIdDiv.innerHTML =  "Player " + (playerId + 1);
    } else {
      // If player is not set, then this controller is not active
      activePlayerDiv.style.display = "none";
      inactivePlayerDiv.style.display = "block";

      playerIdDiv.innerHTML = "Too many players!";
    }
  };

  // Set up listeners for inputs that are sent to the screen
  let inputs = document.getElementsByClassName("input");
  Array.from(inputs).forEach(element => {
    element.addEventListener("mousedown", function () {
      sendInput(element.id, "press");
    });
    element.addEventListener("mouseup", function () {
      sendInput(element.id, "release");
    });
    element.addEventListener("touchstart", function () {
      sendInput(element.id, "press");
    });
    element.addEventListener("touchend", function () {
      sendInput(element.id, "release");
    });
  });

  function sendInput(inputName, direction) {
    message = {
      type: "input",
      input: inputName,
      direction: direction,
    };
    airconsole.message(AirConsole.SCREEN, message);
  }

  // Listen for messages
  airconsole.onMessage = function (from, data) {
    // Show message on device screen
    var info = document.createElement("DIV");
    info.innerHTML = data;
    document.body.appendChild(info);
  };

  // Listen for screen changes (lobby/game/etc)
  airconsole.onCustomDeviceStateChange = function (device_id, data) {
    if(device_id === AirConsole.SCREEN) {
      if(data.screen !== undefined) {
        if(data.screen === "lobby") {
          document.getElementById("screen-lobby").style.display = "block";
          document.getElementById("screen-game").style.display = "none";
        } else if(data.screen === "game") {
          document.getElementById("screen-lobby").style.display = "none";
          document.getElementById("screen-game").style.display = "block";
        }
      }
    }
  };
</script>
